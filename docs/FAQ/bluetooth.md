<a name="XCLDq"></a>
## 一、心率篇
<a name="yIsl0"></a>
### 1.1、采集值0代表的意思，是否还有其他特殊值？
> 心率为0表示未采集到心率数据，这种情况通常有以下几种可能：
> 1、用户未正确佩戴手环。
> 2、手环电量低，开启了低电量模式。
> 3、用户未打开连续心率监测功能。
> 在手环上， 心率采用一个字节来存储，正常情况下， 换算为整型数字范围为0~255，通常用户的心率应该位于40（深睡）~200（极限运动）之间，超过或低于这个范围的心率数值都是不正常的。不会出现低于0或大于255的情况



<a name="zqwD8"></a>
### 1.2、心率数据有时会一条出现多条心律值，这个的逻辑是如何设计的?
> 心率的类型有三种，按照时间周期可划分为5分钟一笔的日常心率监测，1分钟一笔的运动模式心率监测和1s中一笔的实时心率，按照这三种类型， 心率数据的上报又分别对应不同的上报逻辑
> 1、5分钟一笔的心率数据：在手环正常连接的情况下， 心率按照每5分钟一个心率值上报，如果用户手环未和app正常连接， 心率会聚合存储在手环中， 等待下次连接成功时一起上报，上报的数据结构中包含：
> - utc：开始时间（秒）
> - offset：每笔数据的间隔时间（300秒）
> - 心率值
> 
如果在这期间某比数据未检测到心率，会自动填充0， 该模式下每天最多产生288比心率数据
> 2、1分钟一笔的运动心率：在手环开启相关的运动类型开始运动后， 手环会按照1分钟一笔的频率自动记录用户在运动期间的心率值，运动过程中不会上传心率， 只有在运动结束时，才会聚合上报，运动过程中不会上报心率数据
> ，上报的数据结构中包含：
> - utc：开始时间（秒），结束时间需要研发者按照心率的笔数和offset来计算
> - offset：每笔数据的间隔时间（60秒）
> - 心率值
> 
3、1秒钟一笔的实时心率：这种模式默认情况下不开启， 研发者需要调用相关的开启实时心率的api，才会能获取到实时心率。开启后，手环不会记录在开启期间的运动心率值，只会实时更新特征（180D，具体可参考Bluetooth SIG定义的标准蓝牙协议特征值说明）通道上的实时心率特征值，sdk会开启间隔1秒轮询定时线程，每隔一秒读取手环上的180D特征值，然后直接回调到上层应用。该模式目前只支持Mambo Hr2， Mambo5和Mambo5S等型号的手环设备，开启后，功耗会有明显的加大，需要开发者结合自身的场景慎重使用！



<a name="faa8e0e9"></a>
### 1.3、没有心率数据

- 手环支持心率监测
> 乐心一些旧型号的手环不支持心率监测

- 手环心率开关未打开
> 确定是否打开连续心率监测开关，请参照开发文档：[https://docs.leshiguang.com/#/develop-native/android/bluetooth?id=_523%e3%80%81%e8%ae%be%e7%bd%ae%e5%bf%83%e7%8e%87%e6%a3%80%e6%b5%8b](https://docs.leshiguang.com/#/develop-native/android/bluetooth?id=_523%e3%80%81%e8%ae%be%e7%bd%ae%e5%bf%83%e7%8e%87%e6%a3%80%e6%b5%8b)，确保正确设置

- 手环处于低电量模式，已自动关闭心率监测
> 请及时充电

- 重启手环
> 用手环的USB充电口，连续插拔三次可以触发手环重启



<a name="yhI1Q"></a>
## 二、步数篇
<a name="KoBkq"></a>
### 2.1、步数数据似乎不是连续采集，中间有断层，是在什么情况下会上传步数？
> 步数的上传不是连续且有规律的，它的上报发生在手环步数变化之后， 只要手环上的数字有变更， 一般就能收到实时的上报反馈， 如果没有变更，不会触发手环步数的上报逻辑。
> 手环的步数有两种：
> 1、当天或历史的总步数（按天聚合，当天的update， 历史的insert）
> 2、分小时的步数（按小时聚合上报， 一天最多24比小时数据）
> 手环上报的步数始终是用户当天步数的总和而不是手环步数变化的增量，开发者在存储用户当天或历史总步数时，需要做覆盖更新的操作，而不能做累加的操作。



<a name="APpA3"></a>
## 三、睡眠篇
<a name="G7MR8"></a>
### 3.1、睡眠数据是否连续采集？以及睡眠数据上传值的意义是什么？
> 手环3~4秒采集一次用户当前的活动状态，采集后，每5分钟会聚合上报到app，数据语义上描述的是用户在这5分钟内产生的体动状况（比如翻身、抬手等），这段数据是无法脱离睡眠分析算法来工作的， 需要通过云端API的方式来调用乐心睡眠算法服务来获取睡眠分析结果（算法对接请转至：hezuo.lifesense.com），乐心的睡眠算法最短计算单元为15分钟。

<a name="1YtFp"></a>
### 3.2、睡眠原始数据如何获取？
> 请先按照蓝牙sdk接入文档：（[https://docs.leshiguang.com/#/develop-native/android/bluetooth](https://docs.leshiguang.com/#/develop-native/android/bluetooth)），完成sdk的集成工作，蓝牙设备连接成功后， 每5分钟会主动上报一次睡眠原始数据，上报数据结构如下：

```json
{
	"deviceId": null,
	"broadcastId": "D37B60545BB4",
	"sendingPeriod": 0,
	"utc": 1603562999,
	"remainCount": 304,
	"deltaUtc": 300,
	"sleeps": "100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 101; 101; 120; 120; 120; 120;",
	"measureTime": "2020-10-27 14:55:00"
}

```
> 如您需要进一步分析，需要通过开放平台睡眠算法(请转至：hezuo.lifesense.com)对接算法分析能力，在和算法平台对接时， 您需要将采集到的用户体动状态点转换为16进制，并拼接成16进制字符串（不区分大小写）。
> 如将采集到的“100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 100; 101; 101; 120; 120; 120; 120;”转为“646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646578787878”

<a name="MOEhB"></a>
### 3.3、睡眠的算法接口只能上报一段睡眠原始数据，我需要自己对原始数据做拼接？如果在此期间数据有中断应该怎么处理？
> 1、您只需要在用户有睡眠数据产生时，实时上传睡眠的原始数据，就能得到分析结果。
> 2、算法中心会保留历史传输的数据片段，并在新的睡眠原始数据到来后，重新做分析，得到最新的分析结果，因此您不需要拼接睡眠原始数据片段，用户的睡眠数据每隔5分钟就会上报一次，只需要做增量同步分析的操作，在此之后，您需要对历史产生的分析结果做更新操作，以保证始终向用户展示的是当前状态。
> 3、用户正常佩戴手环时，您得到的睡眠原始数据是连续的， 如果未正常佩戴，可能会出现数据中断的情况，但是在分析层面，您不需要关心数据是否连续或数据采集失败的现象（我们无法判断用户当前是否处于正常佩戴或手环电量耗尽的情况），只需要参照第“2”点，将能够采集到的数据片段上报至开放平台，就能得到基于当前已经采集到数据的分析结果。


<a name="X6nFX"></a>
## 四、连接篇
<a name="WsaHI"></a>
### 4.1 手环无法连接

- 手环是否激活
> 新乐心手环（除bobon、bobonC外）需充电激活才可连接，请将手环激活后再尝试连接手机。

- 检查手环蓝牙连接标识
> MamboHR2、Mambo5、Mambo5S已经处于连接状态时，在手环的首屏停留片刻，顶部会弹出蓝牙标识，如果处于断开的状态，顶部弹出的蓝牙标识上有一个“X”符号。Mambo 3已经处于连接状态时，顶部不会出现蓝牙连接图标

- 手环是否在手机附近
> 乐心手环使用蓝牙和手机连接，所以当连接手机时，手机和手环的距离越近越有利于找到手环。

- 手环是否电量耗尽
> 如果手环激活，且手环和手机距离很近还是无法寻找到，可能是因为手环没电了。请将手环进行充电，然后再尝试使用手环连接手机。低电量模式（10%以下）下存在连接困难的问题

- 手环被其他手机连接<br />
> 手环近期被别的手机绑定或连接过（m5/m5s等能在表盘上显示蓝牙是否连接），需要主动在蓝牙设置里忽略该设备。此种情况在苹果手机上发生较多，当用户苹果和安卓设备互相切换时，还需要在苹果的蓝牙设置里，把该设备主动忽略掉。排查设备是否曾经被苹果手机绑定，需要主动到苹果手机 - 蓝牙 - 忽略掉该设备（苹果设备强占蓝牙，若不主动忽略，会导致其它设备无法连接），杀掉APP进程，打开然后再次尝试

- 查看手环是否被系统蓝牙连接
> 主动到手机 - 设置 - 蓝牙，查看是否已连接，主动忽略已连接的设备（建议把非在用或不认识的设备，一律忽略掉）

- 给予定位权限并打开定位服务
> 在Android6.0上设备，蓝牙的搜索需要定位权限，且某些机型还需要开启定位服务才能扫描到附近的蓝牙设备，请给予定位权限并开启定位服务尝试。

- 重启App
> 先杀掉当前App进程，然后重新打开。重启后，会检查当前App连接的一些必要条件，并给出提示，重启后打开App首页，即可自动触发连接。

- 重启蓝牙、重启手机或开关飞行模式
> 手机开启下飞行模式，5秒后关闭飞行模式（开启飞行模式关闭后系统会重置手机蓝牙），杀掉APP进程，打开然后再次尝试。经过以上尝试，还是不能连接蓝牙，可以尝试将手机的蓝牙关闭后重新打开，稍等片刻，重新搜索手环，如若还不行尝试重启手机。

- 重启手环
> 用手环的USB充电口，连续插拔充电口三次可以触发手环重启流程，手环重启后，然后再尝试使用手环连接手机。

<a name="yL2xD"></a>
### 


<a name="1zwLJ"></a>
## 五、数据同步篇
<a name="f6K3S"></a>
### 5.1、数据同步的时机
1、手环、秤、血压计的数据交互均是推送型， 即app和手环连接成功后，手环立即主动同步给App（电量状况良好）, app只做被动接收， 不存在app主动拉取数据的操作。<br />2、运动期间的产生的运动数据（运动报告、运动卡路里、运动心率、运动配速）不会实时上报，上传时机为运动结束时， 运动卡路里、运动心率、运动配速的时间间隔均为1min一比。如果您想获取实时运动心率（比如我有实时播报用户运动心率指导用户运动的需求），需要单独调用实时运动设置接口开启，届时实时运动心率会1秒钟上报一次<br />3、步数、每日消耗卡路里、身体活动量这些数据的上报有两个时机，一是触发步数变更后实时上报（连接状态）；二是每小时的59分59秒生成当前小时的总结数据并上报<br />4、日常心率、睡眠监测数据均是5分钟产生一笔并上报<br />5、睡眠心率和晨脉均是取日常心率监测值， 并根据睡眠时段截取<br />

<a name="jj3fG"></a>
### 5.2、数据存储&数据备份
1、在非大量运动数据生产的情况下， 手环一般可存储5~15天的测量数据，超过手环存储空间，会触发淘汰规则，最早生产的数据优先淘汰，以确保最新的测量数据能够存储下来<br />2、数据上传的完整性由SDK保证， 不会出现丢包、半包的情况，要么全部上传并回调给上层、要么全部上传失败重新上传，手环多次上传失败后，会断开连接，重新连接后会恢复数据上传<br />3、一旦手环数据上传后，手环会立即删除该数据， 不存在备份，开发者在对接sdk时，务必在上传服务器成功之后再做删除，否则需要做重新上传，注意这里也存在实际网络请求触达到服务器，但是接口响应超时的情况（服务器已经处理数据，客户端先断开连接），后台开发者需要根据数据上报的时间做幂等处理， 防止数据重复<br />4、每条数据的唯一性一般通过utc（测量时间）和数据类型来标识<br />5、一般后台存储可以采用时序数据库（对可穿戴设备而言是最优选择），有条件的接入方应该优先采取此方案，没有此条件的接入方建议对测量数据做压缩处理（比如16进制、32进制表示法）。<br />6、由于手环的工作状态情况中可能发生暂停测量的情况（比如关闭心率开关、电量耗尽、未佩戴或未正确佩戴等），因此上报到服务器后，数据是不连续的，开发者需要自己根据数据特性来鉴别哪段时间是无数据的。<br />

<a name="6iBld"></a>
### 5.3、手环数据无法同步

- 确定手环是否已连接
> 手环数据的同步，需要App已连接，如若手环未连接，请先连接设备

- 重启App
> App重启后，会触发手环的重新连接和同步，重启后在手环连接成功，在首页下拉刷新试试。

- 重启手环
> 手环重启后，App会重新和手环建立连接，重新同步数据。如若当前步数不能同步，可以试着摇晃几次手环，让手环步数发生变化，然后查看app数据。



<a name="Jl1qD"></a>
## 六、设置篇
<a name="nFt9g"></a>
### 6.1、设置的读取问题
1、sdk不会读取设备上的设置（大部分设置无此功能），因此需要将设置状态保存到接入方自己的服务器上<br />2、为了保证手环在多终端、多系统、多用户之间的设置状态一致性，接入方的需要保持配置唯一标识的一致性，且使用设备唯一标识（mac地址或deviceId）为维度来存储设置，多用户、多系统多终端之间应该共享设置，否则会出现设置项的不一致性， 例如幽灵闹钟问题<br />3、事件提醒为带文字标签的闹钟（比如喝水提醒），建议接入方接入事件提醒闹钟而丢弃原始闹钟，以便给用户更好的体验。<br />4、集合型的设置（闹钟、事件提醒等）一般最多同时支持5个，以顺序为唯一标识<br />5、天气设置需要开发者自己对接天气服务（一般为第三方服务），并且在设备连接成功时，从服务器请求下发，要求包含天气类型、温度和aqi信息，我方不提供天气服务或收费提供<br />
<br />

<a name="zZvlT"></a>
## 七、数据解读篇
1、一般性的指标解读请走开放平台， 对接算法服务：hezuo.lifesense.com<br />2、深度的指标解读、建议、趋势等，需要做账号打通（静默产生openid流程），使用IoT平台SDK或接入方自己按照数据上报标准上报数据，通过接口拉取分析结果:[https://docs.leshiguang.com/#/develop-cloud/health/login](https://docs.leshiguang.com/#/develop-cloud/health/login)<br />

<a name="xOwl5"></a>
## 八、C端的帮助文档
建议接入者在设备详情页中露出帮助手册，避免一些因为用户自身操作问题而带来的客诉问题，帮助文档中已经过滤了所有和乐心相关的信息，并且会持续迭代， 帮助文档地址：[http://m.leshiguang.com/message/dingding-issue.html](http://m.leshiguang.com/message/dingding-issue.html)<br />

<a name="4sx97"></a>
## 九、日志分析接入
我们鼓励接入者在公司政策允许的情况下接入我们的日志组件，并在合适的时机（比如用户提交意见反馈）将sdk产生的日志上报到我们平台，用于帮助我们的开发者定位用户产生的问题，日志组件是非侵入式的， 接入者只需要调用上传API即可，日志组件不会收集包含除用户ID和外设上报数据外的任何信息<br />

<a name="gxg1J"></a>
## 十、拾果云
<a name="vD045"></a>
### 10.1、是否支持私有化部署
不支持，拾果的云端目前主要使用的是UCloud提供的云主机和设施，部分服务部署在亚马逊云、腾讯云上。由于不同客户采用的云厂商服务不同，或有部分客户自建IDC,  在我们需要重新建设或适配客户的集群管理、网络设施、硬件设施等，受限于我们当前的运维资源和云平台能力，当前我们提供的服务还不具备私有化部署能力和提供部署后的长期运维能力。
<a name="LbPKc"></a>
### 10.2、设备SN和MAC对应的关系通过何种途径获取
当前尚不支持接口拉取和线上同步, 目前由销售线下给到出厂设备的信息表, 由客户自己录入。<br />
<br />


